<mat-card class="upload-card">
  <mat-card-title>Upload File to Process</mat-card-title>

  <!-- MOSTRAR CODIGO GENERADO, SI YA ESTÁ -->
  <div class="processing-code-row" *ngIf="processingCode">
    <mat-form-field appearance="outline">
      <mat-label>Processing Code</mat-label>
      <input matInput [value]="processingCode" readonly />
      <button mat-icon-button matSuffix (click)="copyToClipboard(processingCode)">
        <mat-icon>content_copy</mat-icon>
      </button>
    </mat-form-field>
  </div>

  <!-- FILE PICKER -->
  <div class="file-picker-row">
    <label class="file-picker-label">File:</label>
    <input
      #fileInput
      type="file"
      accept=".txt"
      (change)="onFileSelected($event)"
      hidden
    />
    <mat-form-field appearance="outline" class="file-path-field">
      <input
        matInput
        type="text"
        [value]="selectedFileName"
        placeholder="No file selected"
        readonly
      />
    </mat-form-field>
    <button mat-stroked-button color="primary" (click)="onSelectFileClick()">
      <mat-icon>folder_open</mat-icon>
      <span>Select</span>
    </button>
  </div>

  <!-- TOKENS CONFIG -->
  <div class="tokens-config-row" [formGroup]="form">
    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Tokens per Prompt</mat-label>
      <input
        matInput
        type="number"
        formControlName="promptTokens"
        min="100"
        max="500"
      />
      <mat-hint>Min 100 – Max 500</mat-hint>
      <mat-error *ngIf="promptTokensControl?.hasError('required')">
        Required
      </mat-error>
      <mat-error *ngIf="promptTokensControl?.hasError('min') || promptTokensControl?.hasError('max')">
        Invalid range
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="half-width">
      <mat-label>Tokens per Batch</mat-label>
      <input
        matInput
        type="number"
        formControlName="batchTokens"
        min="1000"
        max="3000"
      />
      <mat-hint>Min 1000 – Max 3000</mat-hint>
      <mat-error *ngIf="batchTokensControl?.hasError('required')">
        Required
      </mat-error>
      <mat-error *ngIf="batchTokensControl?.hasError('min') || batchTokensControl?.hasError('max')">
        Invalid range
      </mat-error>
    </mat-form-field>
  </div>

  <!-- BOTÓN PROCESAR -->
  <div class="process-button-row">
    <button
      mat-raised-button
      color="accent"
      (click)="onProcess()"
      [disabled]="!form.valid || !hasFileSelected"
    >
      <mat-icon>play_arrow</mat-icon>
      <span>Process</span>
    </button>
  </div>

  <!-- BARRA DE PROGRESO -->
  <div class="progress-row" *ngIf="progressValue !== 0">
    <mat-progress-bar
      mode="determinate"
      [value]="progressValue"
    ></mat-progress-bar>
    <span class="progress-text">{{ progressValue }}%</span>
  </div>

  <!-- MENSAJE DE ESTADO -->
  <div class="status-row" *ngIf="statusMessage">
    <mat-icon *ngIf="!isError" class="status-icon success-icon">check_circle</mat-icon>
    <mat-icon *ngIf="isError"  class="status-icon error-icon">error</mat-icon>
    <span [ngClass]="{ 'error-text': isError, 'success-text': !isError }">
      {{ statusMessage }}
    </span>
  </div>
</mat-card>
